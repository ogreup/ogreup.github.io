<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Fedora25安装YouCompleteMe | Ogreup's TechNote</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Fedora25安装YouCompleteMe</h1><a id="logo" href="/.">Ogreup's TechNote</a><p class="description">一个软件攻城狮的所做所想，以及踩坑经验分享</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Fedora25安装YouCompleteMe</h1><div class="post-meta">Apr 16, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/04/16/Fedora25安装YouCompleteMe/" href="/2017/04/16/Fedora25安装YouCompleteMe/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>写这篇笔记的时候，我觉得自己像是职业的“产品评测人员“，在一段时间里孜孜不倦地摆弄某个东西，也许能够发现一些问题，但可能这些问题绝大多数人都不会遇到。我不知道这是否有意义。<br><a id="more"></a></p>
<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><p>前段时间买了个笔记本，人生中第一台自己的笔记本，型号是ThinkPad T460。什么都挺好（4g内存我都忍了），除了显示屏：分辨率是1366x768。是的，你没有看错，这是我在2017年买的全新笔记本所使用的分辨率，可能现在中低端手机上的屏幕分辨率都得比这个高。</p>
<p>装了Android Studio，我只能说写代码的感觉相当憋把：一屏下来就显示不了多少代码，不论是长度还是宽度；界面编辑看着也相当难受。</p>
<p>当然，一切在终端下看着还好。</p>
<p>于是，把vim折腾成开发环境就有了很充足的理由。而且最近学习django，也确实在vim下写了一些python代码，时常YY如果vim能够自动补全django库得多爽。终端下的代码自动补全？必须上YouCompleteMe啊！</p>
<p>我的操作系统是Fedora 25 64bit，内核版本4.10.6-200.fc25.x86_64。部分内容根据事后回忆整理，不一定准确，仅供参考。</p>
<h2 id="下载YCM"><a href="#下载YCM" class="headerlink" title="下载YCM"></a>下载YCM</h2><p>我是通过Vundle这一插件管理工具下载YCM的，访问github可能需要使用代理。在我的情况下载速度相当慢，有好几次出现了异常中断的情况。不过这些与本文主题关系不大，略过不表。</p>
<h2 id="简易模式安装"><a href="#简易模式安装" class="headerlink" title="简易模式安装"></a>简易模式安装</h2><p>YCM提供了安装脚本，这也是我首先选择的安装方式。不幸的是，脚本执行过程中需要下载<code>clang+llvm</code>的一个prebuilt包，在我的情况中是就是<a href="http://releases.llvm.org/4.0.0/clang+llvm-4.0.0-x86_64-linux-gnu-ubuntu-14.04.tar.xz" target="_blank" rel="external">Clang for x86_64 Ubuntu 14.04</a>。虽然通过传入<code>--system-libclang</code>参数使用系统自带clang库（Fedora 25已自带或可以通过dnf安装clang-libs，版本是3.9.1）而免去下载过程，但YCM强烈不建议这么做：</p>
<blockquote>
<p>NOTE: We STRONGLY recommend AGAINST use of the system libclang instead of the upstream compiled binaries. Random things may break. Save yourself the hassle and use the upstream pre-built libclang.</p>
</blockquote>
<p>似乎这个站点的下载速度更慢（四川电信169套餐，号称带宽100Mb），试过几次，看着下载进度以几分钟1%的速度更新，最后终于决定还是放弃了。</p>
<p>没有其它办法，只能选择YCM官方文档中的<a href="https://github.com/Valloric/YouCompleteMe#full-installation-guide" target="_blank" rel="external">Full Installation Guide</a>模式，但这也需要前面提到的那个prebuilt包。于是在uget中新建了一个下载任务，电脑开着的时候就下载。</p>
<h2 id="完全模式安装"><a href="#完全模式安装" class="headerlink" title="完全模式安装"></a>完全模式安装</h2><p>几天之后，Clang for x86_64 Ubuntu 14.04终于下载完毕。我把它解压到~/clang-latest目录下（包含bin, include, lib等子目录）。本以为剩下就configure &amp;&amp; make &amp;&amp; make install就没我啥事儿了，没想到按照YCM文档，在第一步生成makefile的时候就出错了。<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">paul at fed in ~/ycm_build</div><div class="line">$ cmake -G "Unix Makefiles" -DPATH_TO_LLVM_ROOT=~/clang-latest . ~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp</div><div class="line">-<span class="ruby">- The C compiler identification is GNU <span class="number">6.3</span>.<span class="number">1</span></span></div><div class="line"><span class="ruby">-- The CXX compiler identification is GNU <span class="number">6.3</span>.<span class="number">1</span></span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working C <span class="symbol">compiler:</span> /usr/bin/cc</span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working C <span class="symbol">compiler:</span> /usr/bin/cc -- works</span></div><div class="line"><span class="ruby">-- Detecting C compiler ABI info</span></div><div class="line"><span class="ruby">-- Detecting C compiler ABI info - done</span></div><div class="line"><span class="ruby">-- Detecting C compile features</span></div><div class="line"><span class="ruby">-- Detecting C compile features - done</span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working CXX <span class="symbol">compiler:</span> /usr/bin/c++</span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working CXX <span class="symbol">compiler:</span> /usr/bin/c++ -- works</span></div><div class="line"><span class="ruby">-- Detecting CXX compiler ABI info</span></div><div class="line"><span class="ruby">-- Detecting CXX compiler ABI info - done</span></div><div class="line"><span class="ruby">-- Detecting CXX compile features</span></div><div class="line"><span class="ruby">-- Detecting CXX compile features - done</span></div><div class="line"><span class="ruby">-- Found <span class="symbol">PythonLibs:</span> /usr/lib64/libpython2.<span class="number">7</span>.so (found suitable version <span class="string">"2.7.13"</span>, minimum required is <span class="string">"2.6"</span>) </span></div><div class="line"><span class="ruby">Using libclang to provide semantic completion <span class="keyword">for</span> C/C++<span class="regexp">/ObjC</span></span></div><div class="line"><span class="ruby">CMake Error at ycm/CMakeLists.<span class="symbol">txt:</span><span class="number">315</span> (file)<span class="symbol">:</span></span></div><div class="line"><span class="ruby">  file RENAME failed to rename</span></div><div class="line"><span class="ruby"></span></div><div class="line"><span class="ruby">    /home/paul/clang-latest/lib/libclang.so..</span></div><div class="line"><span class="ruby"></span></div><div class="line"><span class="ruby">  to</span></div><div class="line"><span class="ruby"></span></div><div class="line"><span class="ruby">    /home/paul/clang-latest/lib/libclang.so.</span></div><div class="line"><span class="ruby"></span></div><div class="line"><span class="ruby">  <span class="symbol">because:</span> No such file <span class="keyword">or</span> directory </span></div><div class="line"><span class="ruby">  </span></div><div class="line"><span class="ruby">  Using external <span class="symbol">libclang:</span> /home/paul/clang-latest/lib/libclang.so.<span class="number">4.0</span></span></div><div class="line"><span class="ruby">-- Found <span class="symbol">PythonInterp:</span> /usr/bin/python2.<span class="number">7</span> (found version <span class="string">"2.7.13"</span>) </span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread.h</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread.h - found</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create - <span class="keyword">not</span> found</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthreads</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthreads - <span class="keyword">not</span> found</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthread</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthread - found</span></div><div class="line"><span class="ruby">-- Found <span class="symbol">Threads:</span> TRUE</span></div><div class="line"><span class="ruby">-- Configuring incomplete, errors occurred!</span></div><div class="line"><span class="ruby">See also <span class="string">"/home/paul/ycm_build/CMakeFiles/CMakeOutput.log"</span>.</span></div><div class="line"><span class="ruby">See also <span class="string">"/home/paul/ycm_build/CMakeFiles/CMakeError.log"</span>.</span></div></pre></td></tr></table></figure></p>
<p>上面cmake的输出中提示执行RENAME的时候出错了，但我感觉这应该不是一个关键错误（这一判断是整个过程中我所犯的关键错误。。。），于是从CMakeError.log中寻找线索：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Determining <span class="keyword">if</span> the function pthread_create exists <span class="keyword">in</span> the pthreads failed with the following <span class="string">output:</span></div><div class="line">Change <span class="string">Dir:</span> <span class="regexp">/home/</span>paul<span class="regexp">/ycm_build/</span>CMakeFiles/CMakeTmp</div><div class="line"></div><div class="line">Run Build <span class="string">Command:</span><span class="string">"/usr/bin/gmake"</span> <span class="string">"cmTC_565cb/fast"</span></div><div class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/gmake -f CMakeFiles/</span>cmTC_565cb.dir<span class="regexp">/build.make CMakeFiles/</span>cmTC_565cb.dir/build</div><div class="line">gmake[<span class="number">1</span>]: Entering directory <span class="string">'/home/paul/ycm_build/CMakeFiles/CMakeTmp'</span></div><div class="line">Building C object CMakeFiles<span class="regexp">/cmTC_565cb.dir/</span>CheckFunctionExists.c.o</div><div class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/cc    -DCHECK_FUNCTION_EXISTS=pthread_create   -o CMakeFiles/</span>cmTC_565cb.dir<span class="regexp">/CheckFunctionExists.c.o   -c /</span>usr<span class="regexp">/share/</span>cmake<span class="regexp">/Modules/</span>CheckFunctionExists.c</div><div class="line">Linking C executable cmTC_565cb</div><div class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/cmake -E cmake_link_script CMakeFiles/</span>cmTC_565cb.dir/link.txt --verbose=<span class="number">1</span></div><div class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/cc   -DCHECK_FUNCTION_EXISTS=pthread_create    CMakeFiles/</span>cmTC_565cb.dir/CheckFunctionExists.c.o  -o cmTC_565cb -rdynamic -lpthreads </div><div class="line"><span class="regexp">/usr/</span>bin/<span class="string">ld:</span> cannot find -lpthreads</div><div class="line"><span class="string">collect2:</span> <span class="string">error:</span> ld returned <span class="number">1</span> exit status</div><div class="line">CMakeFiles<span class="regexp">/cmTC_565cb.dir/</span>build.<span class="string">make:</span><span class="number">97</span>: recipe <span class="keyword">for</span> target <span class="string">'cmTC_565cb'</span> failed</div><div class="line">gmake[<span class="number">1</span>]: *** [cmTC_565cb] Error <span class="number">1</span></div><div class="line">gmake[<span class="number">1</span>]: Leaving directory <span class="string">'/home/paul/ycm_build/CMakeFiles/CMakeTmp'</span></div><div class="line"><span class="string">Makefile:</span><span class="number">126</span>: recipe <span class="keyword">for</span> target <span class="string">'cmTC_565cb/fast'</span> failed</div><div class="line"><span class="string">gmake:</span> *** [cmTC_565cb/fast] Error <span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>原来是在检测pthread库的时候出错了。不过这个<code>/usr/bin/ld: cannot find -lpthreads</code>很奇怪，应该<code>-lpthread</code>才对啊，怎么多了一个s？于是在网上查找相关信息，居然没有遇到和我同样问题的。不过，通过查看相关帖子我发现cmake（我使用的版本是cmake 3.6.2，系统自带）在pthread库测试方面倒是有各种稀奇古怪的选项，比如说我可能需要这个<code>THREADS_PREFER_PTHREAD_FLAG</code>，启用该选项后指示gcc在使用pthread库时使用<code>-pthread</code>而不是<code>-lpthread</code>（居然还能这样写，我真是孤陋寡闻了）。是否需要启用该选项要看gcc的版本，似乎老一点的gcc就不支持<code>-pthread</code>（我的gcc版本是6.3.1，应该算是相当新了），于是，我在<code>~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/ycm/tests/gmock/gtest/cmake/internal_utils.cmake</code>文件中增加了一行：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set(<span class="name">THREADS_PREFER_PTHREAD_FLAG</span> <span class="number">1</span>) # new</div><div class="line">find_package(<span class="name">Threads</span>)</div></pre></td></tr></table></figure></p>
<p>以为万事大吉，不过cmake还是出错了，但这一次CMakeError.log给出的信息不一样了：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Determining <span class="keyword">if</span> the pthread_create exist failed with the following output:</div><div class="line">Change <span class="keyword">Dir</span>: /home/paul/ycm_build/CMakeFiles/CMakeTmp</div><div class="line"></div><div class="line"><span class="keyword">Run</span> Build Command:<span class="string">"/usr/bin/gmake"</span> <span class="string">"cmTC_502dd/fast"</span></div><div class="line">/usr/bin/gmake -f CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/build.make CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/build</div><div class="line">gmake[1]: Entering directory '/home/paul/ycm_build/CMakeFiles/CMakeTmp'</div><div class="line">Building C object CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/CheckSymbolExists.c.o</div><div class="line">/usr/bin/<span class="keyword">cc</span>     -o CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/CheckSymbolExists.c.o   -c /home/paul/ycm_build/CMakeFiles/CMakeTmp/CheckSymbolExists.c</div><div class="line">Linking C executable cmTC_502dd</div><div class="line">/usr/bin/cmake -<span class="keyword">E</span> cmake_link_script CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/link.txt --verbose=1</div><div class="line">/usr/bin/<span class="keyword">cc</span>       CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/CheckSymbolExists.c.o  -o cmTC_502dd -rdynamic </div><div class="line">CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/CheckSymbolExists.c.o: <span class="keyword">In</span> function <span class="symbol">`main'</span>:</div><div class="line">CheckSymbolExists.c:(.text+0x16): undefined reference to <span class="symbol">`pthread_create'</span></div><div class="line">collect2: <span class="keyword">error</span>: ld returned 1 <span class="keyword">exit</span> status</div><div class="line">CMakeFiles/cmTC_502dd.<span class="keyword">dir</span>/build.make:97: recipe <span class="keyword">for</span> target 'cmTC_502dd' failed</div><div class="line">gmake[1]: *** [cmTC_502dd] <span class="keyword">Error</span> 1</div><div class="line">gmake[1]: Leaving directory '/home/paul/ycm_build/CMakeFiles/CMakeTmp'</div><div class="line">Makefile:126: recipe <span class="keyword">for</span> target 'cmTC_502dd/fast' failed</div><div class="line">gmake: *** [cmTC_502dd/fast] <span class="keyword">Error</span> 2</div></pre></td></tr></table></figure></p>
<p>我心说这特么都啥**玩意儿啊？装个软件还这么费尽？人生到底图个啥？</p>
<h2 id="解决第一个编译错误"><a href="#解决第一个编译错误" class="headerlink" title="解决第一个编译错误"></a>解决第一个编译错误</h2><p>第一次尝试修改失败，只得认真看看cmake输出的关于RENAME的错误提示到底怎么来的。打开 ~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/ycm/CMakeList.txt，定位到315行附近：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># One can use the system libclang.[so|dylib] like so:</span></div><div class="line"><span class="comment">#   cmake -DUSE_SYSTEM_LIBCLANG=1 [...]</span></div><div class="line"><span class="comment"># One can also explicitely pick the external libclang.[so|dylib] for use like so:</span></div><div class="line"><span class="comment">#   cmake -DEXTERNAL_LIBCLANG_PATH=/path/to/libclang.so [...]</span></div><div class="line"><span class="comment"># The final .so we build will then first look in the same dir in which it is</span></div><div class="line"><span class="comment"># located for libclang.so. This is provided by the rpath = $ORIGIN feature.</span></div><div class="line">message(<span class="string">"EXTERNAL_LIBCLANG_PATH=<span class="variable">$&#123;EXTERNAL_LIBCLANG_PATH&#125;</span>"</span>)</div><div class="line">message(<span class="string">"USE_SYSTEM_LIBCLANG=<span class="variable">$&#123;USE_SYSTEM_LIBCLANG&#125;</span>"</span>)</div><div class="line"><span class="keyword">if</span> ( EXTERNAL_LIBCLANG_PATH <span class="keyword">OR</span> USE_SYSTEM_LIBCLANG )</div><div class="line">  <span class="keyword">if</span> ( USE_SYSTEM_LIBCLANG )</div><div class="line">    <span class="keyword">if</span> ( APPLE )</div><div class="line">      <span class="builtin-name">set</span>( ENV_LIB_PATHS ENV DYLD_LIBRARY_PATH )</div><div class="line">    elseif ( UNIX )</div><div class="line">      <span class="builtin-name">set</span>( ENV_LIB_PATHS ENV LD_LIBRARY_PATH )</div><div class="line">    elseif ( WIN32 )</div><div class="line">      <span class="builtin-name">set</span>( ENV_LIB_PATHS ENV PATH )</div><div class="line">    <span class="keyword">else</span> ()</div><div class="line">      <span class="builtin-name">set</span>( ENV_LIB_PATHS <span class="string">""</span> )</div><div class="line">    endif()</div><div class="line">    # On Debian-based systems, llvm installs into /usr/lib/llvm-x.y.</div><div class="line">    file( GLOB SYS_LLVM_PATHS <span class="string">"/usr/lib/llvm*/lib"</span> )</div><div class="line">    # Need TEMP because find_library does <span class="keyword">not</span> work with an option variable</div><div class="line">    # On Debian-based systems only a symlink <span class="keyword">to</span> libclang.so.1 is created</div><div class="line">    find_library( TEMP</div><div class="line">                  NAMES</div><div class="line">                  clang</div><div class="line">                  libclang.so.1</div><div class="line">                  PATHS</div><div class="line">                  <span class="variable">$&#123;ENV_LIB_PATHS&#125;</span></div><div class="line">                  /usr/lib</div><div class="line">                  /usr/lib/llvm</div><div class="line">                  <span class="variable">$&#123;SYS_LLVM_PATHS&#125;</span></div><div class="line">                  /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib</div><div class="line">                  /Library/Developer/CommandLineTools/usr/lib )</div><div class="line">    <span class="builtin-name">set</span>( EXTERNAL_LIBCLANG_PATH <span class="variable">$&#123;TEMP&#125;</span> )</div><div class="line">	<span class="keyword">else</span>() # EXTERNAL_LIBCLANG_PATH is set</div><div class="line">    # <span class="keyword">For</span> Macs, we <span class="keyword">do</span> things differently; look further <span class="keyword">in</span> this file.</div><div class="line">	<span class="keyword">if</span> ( <span class="keyword">NOT</span> APPLE <span class="keyword">AND</span> <span class="keyword">NOT</span> MSVC )</div><div class="line">      # Setting this <span class="keyword">to</span> <span class="literal">true</span> makes sure that libraries we build will have our</div><div class="line">      # rpath <span class="builtin-name">set</span> even without having <span class="keyword">to</span> <span class="keyword">do</span> <span class="string">"make install"</span></div><div class="line">      <span class="builtin-name">set</span>( CMAKE_BUILD_WITH_INSTALL_RPATH <span class="literal">TRUE</span> )</div><div class="line">      <span class="builtin-name">set</span>( CMAKE_INSTALL_RPATH <span class="string">"\$ORIGIN"</span> )</div><div class="line">      # <span class="builtin-name">Add</span> directories <span class="keyword">from</span> all libraries outside the build tree <span class="keyword">to</span> the rpath.</div><div class="line">      # This makes the dynamic linker able <span class="keyword">to</span> <span class="builtin-name">find</span> non<span class="built_in"> system </span>libraries that</div><div class="line">      # our libraries require, <span class="keyword">in</span> particular the Python one (<span class="keyword">from</span> pyenv <span class="keyword">for</span></div><div class="line">      # instance).</div><div class="line">      <span class="builtin-name">set</span>( CMAKE_INSTALL_RPATH_USE_LINK_PATH <span class="literal">TRUE</span> )</div><div class="line">      # When loading our library, the dynamic linker will look <span class="keyword">for</span></div><div class="line">      # libclang.so.4, <span class="keyword">not</span> libclang.so.4.x.</div><div class="line">	file( RENAME</div><div class="line">		<span class="variable">$&#123;EXTERNAL_LIBCLANG_PATH&#125;</span>.<span class="variable">$&#123;CLANG_MAJOR_VERSION&#125;</span>.<span class="variable">$&#123;CLANG_MINOR_VERSION&#125;</span></div><div class="line">		<span class="variable">$&#123;EXTERNAL_LIBCLANG_PATH&#125;</span>.<span class="variable">$&#123;CLANG_MAJOR_VERSION&#125;</span> )</div><div class="line">    endif()</div><div class="line">  endif()</div><div class="line"></div><div class="line">  # On Linux, the library target is a symlink of the soversion one.  Since it</div><div class="line">  # will be copied <span class="keyword">in</span> the project folder, we need the symlinked library.</div><div class="line">  get_filename_component( LIBCLANG_TARGET <span class="string">"<span class="variable">$&#123;EXTERNAL_LIBCLANG_PATH&#125;</span>"</span> REALPATH )</div><div class="line">  message( <span class="string">"Using external libclang: <span class="variable">$&#123;LIBCLANG_TARGET&#125;</span>"</span> )</div><div class="line"><span class="keyword">else</span>()</div><div class="line">  <span class="builtin-name">set</span>( LIBCLANG_TARGET )</div><div class="line">endif()</div></pre></td></tr></table></figure></p>
<p>看起来<code>CLANG_MAJOR_VERSION</code>和<code>CLANG_MINOR_VERSION</code>都没有被正确定义，导致使用其值拼接文件名时出现了问题。不过，即使这些变量被定义了，这样的RENAME好像也没什道理，因为在~/clang-latest/lib目录下目标文件本来就存在了：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">paul at fed in ~<span class="regexp">/clang-latest</span></div><div class="line"><span class="regexp">$ ls -l lib/libclang</span>.so*</div><div class="line">lrwxrwxrwx. <span class="number">1</span> paul paul       <span class="number">13</span> Apr  <span class="number">9</span> <span class="number">21</span>:<span class="number">17</span> <span class="class"><span class="keyword">lib</span>/<span class="title">libclang</span>.<span class="title">so</span> -&gt; <span class="title">libclang</span>.<span class="title">so</span>.4</span></div><div class="line">lrwxrwxrwx. <span class="number">1</span> paul paul       <span class="number">15</span> Apr  <span class="number">9</span> <span class="number">21</span>:<span class="number">17</span> <span class="class"><span class="keyword">lib</span>/<span class="title">libclang</span>.<span class="title">so</span>.4 -&gt; <span class="title">libclang</span>.<span class="title">so</span>.4.0</span></div><div class="line">-rw-r--r--. <span class="number">1</span> paul paul <span class="number">59595439</span> Mar <span class="number">11</span> <span class="number">03</span>:<span class="number">01</span> <span class="class"><span class="keyword">lib</span>/<span class="title">libclang</span>.<span class="title">so</span>.4.0</span></div></pre></td></tr></table></figure></p>
<p>最让我觉得别扭的地方在这里：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">   # <span class="keyword">For</span> Macs, we <span class="keyword">do</span> things differently; look further <span class="keyword">in</span> this <span class="keyword">file</span>.</div><div class="line"><span class="keyword">if</span> ( <span class="keyword">NOT</span> APPLE <span class="keyword">AND</span> <span class="keyword">NOT</span> MSVC )</div></pre></td></tr></table></figure></p>
<p>这注释和紧随其后的代码怎么觉得有点对不上呢？<code>NOT APPLE AND NOT MSVC</code>怎么就成了<code>For Macs</code>了呢？难道是写代码时出现的笔误？抱着试试看的心态，我把<code>if (NOT APPLE AND NOT MSVC)</code>改成了<code>if (NOT UNIX AND NOT MSVC)</code>（修改的实际效果是：if条件块中的语句在我所在平台中不会被执行），我擦，cmake居然顺利通过了！<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">paul at fed in ~/ycm_build</div><div class="line">$ cmake -G "Unix Makefiles" -DPATH_TO_LLVM_ROOT=~/clang-latest . ~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp</div><div class="line">-<span class="ruby">- The C compiler identification is GNU <span class="number">6.3</span>.<span class="number">1</span></span></div><div class="line"><span class="ruby">-- The CXX compiler identification is GNU <span class="number">6.3</span>.<span class="number">1</span></span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working C <span class="symbol">compiler:</span> /usr/bin/cc</span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working C <span class="symbol">compiler:</span> /usr/bin/cc -- works</span></div><div class="line"><span class="ruby">-- Detecting C compiler ABI info</span></div><div class="line"><span class="ruby">-- Detecting C compiler ABI info - done</span></div><div class="line"><span class="ruby">-- Detecting C compile features</span></div><div class="line"><span class="ruby">-- Detecting C compile features - done</span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working CXX <span class="symbol">compiler:</span> /usr/bin/c++</span></div><div class="line"><span class="ruby">-- Check <span class="keyword">for</span> working CXX <span class="symbol">compiler:</span> /usr/bin/c++ -- works</span></div><div class="line"><span class="ruby">-- Detecting CXX compiler ABI info</span></div><div class="line"><span class="ruby">-- Detecting CXX compiler ABI info - done</span></div><div class="line"><span class="ruby">-- Detecting CXX compile features</span></div><div class="line"><span class="ruby">-- Detecting CXX compile features - done</span></div><div class="line"><span class="ruby">-- Found <span class="symbol">PythonLibs:</span> /usr/lib64/libpython2.<span class="number">7</span>.so (found suitable version <span class="string">"2.7.13"</span>, minimum required is <span class="string">"2.6"</span>) </span></div><div class="line"><span class="ruby">Using libclang to provide semantic completion <span class="keyword">for</span> C/C++<span class="regexp">/ObjC</span></span></div><div class="line"><span class="ruby">Using external <span class="symbol">libclang:</span> /home/paul/clang-latest/lib/libclang.so.<span class="number">4.0</span></span></div><div class="line"><span class="ruby">-- Found <span class="symbol">PythonInterp:</span> /usr/bin/python2.<span class="number">7</span> (found version <span class="string">"2.7.13"</span>) </span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread.h</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread.h - found</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create - <span class="keyword">not</span> found</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthreads</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthreads - <span class="keyword">not</span> found</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthread</span></div><div class="line"><span class="ruby">-- Looking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthread - found</span></div><div class="line"><span class="ruby">-- Found <span class="symbol">Threads:</span> TRUE</span></div><div class="line"><span class="ruby">-- Configuring done</span></div><div class="line"><span class="ruby">-- Generating done</span></div><div class="line"><span class="ruby">-- Build files have been written <span class="symbol">to:</span> /home/paul/ycm_build</span></div></pre></td></tr></table></figure></p>
<p>之后的build也顺利通过。什么叫“踏破铁鞋无觅处，得来全不费功夫”，劳资简直有点怀疑人生了。。。想来也许是cmake在一个不应该出错的地方卡了壳，导致后面有些编译选项没有被正确设置，成功地误导我去解决pthread库检测问题。</p>
<p>其实这和编译C++工程时遇到的情况也有些类似，编译器可能给出一大堆抱怨，正确和高效的解决方式是：<strong> 总是应该解决你发现的第一个错误，然后立刻编译一次 </strong>。很多时候，后面出现的错误都是由于第一个错误引起的。</p>
<h2 id="YCM测试运行"><a href="#YCM测试运行" class="headerlink" title="YCM测试运行"></a>YCM测试运行</h2><p>最终的结果，似乎不过是~/.vim/bundle/YouCompleteMe/third_party/ycmd目录下多出来两个文件：libclang.so.4.0和ycm_core.so。这里倒是需要把libclang.so.4.0重命名为libclang.so.4，否则YCM无法正常工作:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">2017-04-16 00:26:33,712 - <span class="keyword">ERROR</span> - libclang.<span class="keyword">so</span>.4: cannot <span class="keyword">open</span> shared object <span class="keyword">file</span>: <span class="keyword">No</span> such <span class="keyword">file</span> or directory</div><div class="line">Traceback (most recent call last):</div><div class="line">  <span class="keyword">File</span> <span class="string">"/home/paul/.vim/bundle/YouCompleteMe/third_party/ycmd/ycmd/server_utils.py"</span>, <span class="keyword">line</span> 95, <span class="keyword">in</span> CompatibleWithCurrentCore</div><div class="line">    ycm_core = ImportCore()</div><div class="line">  <span class="keyword">File</span> <span class="string">"/home/paul/.vim/bundle/YouCompleteMe/third_party/ycmd/ycmd/server_utils.py"</span>, <span class="keyword">line</span> 87, <span class="keyword">in</span> ImportCore</div><div class="line">    import ycm_core <span class="keyword">as</span> ycm_core</div><div class="line">ImportError: libclang.<span class="keyword">so</span>.4: cannot <span class="keyword">open</span> shared object <span class="keyword">file</span>: <span class="keyword">No</span> such <span class="keyword">file</span> or directory</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://ogreup.github.io/2017/04/16/Fedora25安装YouCompleteMe/" data-id="cj78nxtjw0004z4ileh9jlyes" class="article-share-link">Share</a><div class="tags"><a href="/tags/折腾/">折腾</a><a href="/tags/software/">software</a><a href="/tags/linux/">linux</a></div><div class="post-nav"><a href="/2017/05/02/Windows7配置Qt5-7-1开发环境/" class="pre">Windows7配置Qt5.7.1开发环境</a><a href="/2017/04/04/第一个Android应用/" class="next">第一个Android应用</a></div><div id="disqus_thread"><script>var disqus_shortname = 'ogreup';
var disqus_identifier = '2017/04/16/Fedora25安装YouCompleteMe/';
var disqus_title = 'Fedora25安装YouCompleteMe';
var disqus_url = 'https://ogreup.github.io/2017/04/16/Fedora25安装YouCompleteMe/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ogreup.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://ogreup.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/折腾/" style="font-size: 15px;">折腾</a> <a href="/tags/software/" style="font-size: 15px;">software</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/ss/" style="font-size: 15px;">ss</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/踩坑/" style="font-size: 15px;">踩坑</a> <a href="/tags/qt/" style="font-size: 15px;">qt</a> <a href="/tags/programming/" style="font-size: 15px;">programming</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/android/" style="font-size: 15px;">android</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/git无法使用socks5代理/">git无法使用socks5代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/20/thinkpad-t460安装windows7/">Thinkpad T460安装Windows7</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/02/Windows7配置Qt5-7-1开发环境/">Windows7配置Qt5.7.1开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/Fedora25安装YouCompleteMe/">Fedora25安装YouCompleteMe</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/04/第一个Android应用/">第一个Android应用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//ogreup.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Ogreup's TechNote.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>